<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ page.title }} â€” {{ questionnaire.name }}</title>
    <!-- Alpine Plugins -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/persist@3.x.x/dist/cdn.min.js"></script>

    <script defer src="https://unpkg.com/@alpinejs/ui@3.15.8/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/@alpinejs/focus@3.15.8/dist/cdn.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.15.8/dist/cdn.min.js"></script>
    <!-- Include the Play CDN script -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<script>
    document.addEventListener('alpine:init', () => {
        const formDataKey = 'formData' + {{ questionnaire.id }};
        const storageKey = 'q_{{ questionnaire.id }}_formData';

        Alpine.store(formDataKey, JSON.parse(localStorage.getItem(storageKey) || '{}'));

        Alpine.data('questionnairePage', () => ({
            save(event) {
                const fd = new FormData(event.target);
                const data = {};
                for (const key of fd.keys()) {
                    const vals = fd.getAll(key);
                    data[key] = vals.length === 1 ? vals[0] : vals;
                }
                Object.assign(Alpine.store(formDataKey), data);
                localStorage.setItem(storageKey, JSON.stringify(Alpine.store(formDataKey)));
            }
        }));
    });
</script>
<body x-data="questionnairePage">
<h1>{{ questionnaire.name }}</h1>
<h2>{{ page.title }}</h2>
daa {{data }}
<form method="post" @submit="save">

    {% csrf_token %}

    {% if errors %}
    <div class="mb-6 rounded-lg border border-red-200 bg-red-50 p-4">
        <p class="text-sm font-semibold text-red-700 mb-1">Please answer all required fields before continuing.</p>
        <ul class="list-disc list-inside text-sm text-red-600">
            {% for field in errors %}
            <li>{{ field }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {{ rendered_content|safe }}
    <button type="submit">Next</button>
</form>
</body>
</html>
